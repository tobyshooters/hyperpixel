<style>
body {
    margin: 20px 40px;
}
a {
    width: 500px;
}
img {
    width: 500px;
    height: auto;
    object-fit: contain;
    border: 1px solid black;
    margin-bottom: 11px;
}
input {
    border: 1px solid black;
    padding: 5px;
    margin: 0px;
}
</style>

<a href="/">hyperpixel</a>
<div style="margin-top: 10px; display: flex; align-items: center;">
    <input id="search" type="text" placeholder="Search"></input>
    <button id="shuffle" style="margin-left: 10px;">
        Shuffle
    </button>
</div>
<div id="home" style="display: flex; flex-direction: column"></div>

<script>
    const data = {{data | tojson}};
    const query = {{query | tojson}};

    const search = document.getElementById("search");
    search.value = query;
    search.addEventListener("change", e => {
        window.location = `/?query=${e.target.value}`;
    })

    const shuffle = document.getElementById("shuffle");
    shuffle.onclick = () => {
        home.innerHTML = "";
        const imageIds = Object.keys(data).sort(() => Math.random() - 0.5)
        load(imageIds);
    }

    const load = (imageIds) => {
        imageIds.forEach(imageId => {
            const path = data[imageId];

            const label = document.createElement("p");
            label.innerHTML = `/${imageId}`;
            document.getElementById("home").appendChild(label);

            const output = document.createElement("img");
            output.src = path;

            const link = document.createElement("a");
            link.href = `/${imageId}`;
            link.appendChild(output);

            document.getElementById("home").appendChild(link);
        })
    }

    const imageIds = Object.keys(data).sort((a, b) => {
        const _a = a.replace(/[^a-z0-9]/gi,'');
        const _b = b.replace(/[^a-z0-9]/gi,'');
        return _a.localeCompare(_b);
    });
    load(imageIds);
</script>

